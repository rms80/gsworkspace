Note to Claude: this is just notes for myself, please ignore this file.


*Jan 21*

started project! 
The basic idea I started with was to try to vibe-build an app I have always imagined
but never had the time to build. It's an app to help me create documentation for the
software I build. This generally involves many pages of text and images. I create
the images mostly via screencaps, and it's annoying to manage all the files/etc.
I wanted some kind of infinite canvas where I could just drop images and type in
text blocks (initially bullet points, flesh out later etc) and do some basic sptaial
layout and then have it generate reasonable HTML pages from this content.

I've always thought I would build this as a desktop C# app.
I can imagine how that would work. It certainly made more sense to do as a web app
but I don't really do that kind of thing and so it seemed like I would have to learn
a lot to do it. Certainly way more effort than I would ever put in for a "personal" app
that possibly nobody else will ever be interested in. This was also always the barrier
to doing it in C#...a lot of work for some convenience. So it seemed like an ideal thing 
to try to do w/ claude code.

Signed up for Claude Pro

Asked it to create an initial web app with an infinite canvas where I can add images and text blocks and position them, where the canvas is serialized to remote S3 bucket.
It asked me some questions about what kind of frameworks to use, pros and cons of different approaches etc.
Picked React + Konva w/ node back-end.
It generated a functional app.

[[For rest of today I worked by typing prompts one-by-one to make changes.
None of the prompts were very long, at most a few sentences. 
Each was doing a specific feature or change.
Most commits to github included multiple changes made this way. ]]

Implemented a bunch of baseline UI improvements, paste support, filesystem drag-drop
(https://github.com/rms80/workspaceapp/commit/9343680bfe45b729c9151869593d3c3d42e47a07)

Expanded to support multiple active scenes w/ tabs.
Added S3 persistence and immediate serialization
Added 'prompt' object that sends other selected objects to Claude LLM
Added Gemini support
Add 'ImageGen' object that does image generation w/ nanobanana

[[These features were mixed in w/ bug fixing, eg image object rotation & scaling
was supported initially, but it wasn't serialized, had to tell it to do this.
When I (eg) added ImageGen objects, it did not add serialization support initially,
I had to notice that and tell it to do it]]

[[One thing it was not very good at was UI styling. Eg buttons different styles,
misaligned, etc. I often had to go through multiple rounds to get it to what I wanted]]

Got up to CL 59328fff8be38ffbee67105b9bfe42b7cb95182a.
At this point it was pretty functional, it was handling everything I had thrown at it
and the app had actual utility to me

[[Ran out of credits. Said I had to wait a few hours to continue. Upgraded to Claude Max.]]

Asked it to explain how to use the TODO.md approach to doing things. It generated a
TODO.md with a lot of nice features. I put those aside and decided to get it to
implement undo/redo next.

tried to get it to implement a history system from a multi-step description in TODO.md
It basically just made a list of serialized versions of the scene. It worked but was not going to scale,
and probably would have issues being backwards-compatible. Reverted this, done for the day.

(~5 hours elapsed wallclock time since I started)


*Jan 22*

wrote a more explicit description of how I want the history system to be structured and work in the TODO.md.
Was more specific about how I wanted it to store delta-change records, use interfaces for changes and the history
system, implement in separate files, etc.

It churned for 12 minutes, made a PR. System appears to work, however it has a bug, saves multiple records for text changes.
First attempt at fixing the bug made plausible-seeming changes to the code, but it didn't work.
Second attempt made no difference.

[[This was the first significant failure where it didn't immediately know how to fix the problem I identified...]]

At this point I went in with the debugger, and found where the change record was being pushed twice.
Was not obvious to me why that was happening. I asked it to explain and it did a good job (apparently
this is some kind of React feature to detect accidental mutation inside of state update callbacks).
Now it knew what the bug was and suggested two fixes and explained which one was React-idomatic.
But I guess this was a dumb mistake to make in the first place, and I'm not sure it would have figure it out if I didn't step in with the debugger.


Next step is to create an embedded web view, because once the LLM creates a little webpage
from the source text and image assets we need some way to see it. I asked how it would
implement this, it gave me 3 options and recommended the most secure option. 
I had some technical questions, and then I asked it to make a plan in the TODO.md.
I tweaked the plan and said to go ahead.

It worked. Some UX issues but it renders sample HTML. 

Asked it to implement detecting HTML output from LLM and rendering that via this new type of HTML view object.
This works.

Had it fix UX issures around the embedded web views (the iframe causes various complications).
No problems!


*Jan 23*

Todays main task is to implement the LLM webpage generation given the images and text blocks in the canvas.
I wrote a detailed description of this feature in the TODO.md and then asked it to generate a task list. 
My description was a mix of concept, UX description, and notes on particular implementation aspects.
It generated a very detailed set of TODO steps (9 sections each w/ multiple steps).
I did some light editing and set it to it.

This more or less worked. There was an issue with sending the images where it sends too many tokens.
For now it stopped sending the actual images and just sends their description, we need to revisit this.
And it forgot to implement save/load and undo/redo for the HTMLGen objects (again).

[[ At this point I had approximately achieved what I set out to do in the description above. The system
prompt for the html generation needs work, and there are workflow improvements that will make it easier
to actually use this, and lots of possible UX improvements. But it's a very functional MVP (way, way past 
what I would have done in a C# prototype). It's been about 8-10 hours total wallclock time that I have
been "working" on this project (mostly doing something else while CC cooked). I have not written a line
of code, or reviewed any of it before committing (I have skimmed a bit afterwards though). 
I had to go into the debugger twice, and JS console a few times. Wild!! ]]

I wasn't sure what it was actually sending for the HTMLGen so I had it make a debug view, launched from
a new status bar. It had a bit of trouble with this, I think it was always "working" but it took a few
iterations for it to get the UI layout to work.

Next I had it add zoom support to the embedded web views. It suggested 3 possible ways to do this.
I let it do the one it wanted to do. Works OK.

Next I did a bunch of UI improvements. Did these by prompting one-by-one and testing. Mostly got things
right on the first try, a few times we had to iterate. App looks much cleaner now, and UX is nicer.

Discovered some weirdness around the selection system. Figured out it was storing selection state as part of objects.
I gave it paragraph description of how I wanted the selection system to work at the code level and asked it to refactor.
Seems to have done what I asked w/o issues.

Asked CC to do a security audit of the frontend and backend. It found about 20 problems,
several critical. It made a large doc explaining all the issues, with an exmaple of how
it could be abused and suggestions of fixes, and a plan for working through fixing everything.
Did not try this right now.

Asked about usage of data URLs for images. CC identified various places that large data URLs
were likely gettin serialized, and made suggestions to fix. Added to TODO.




Jan 24-26

mostly not working on this project. I added HTML and Markdown export to HTML objects, 
to be able to re-use the generated content. No significant issues. CC found some third-party
libraries suitable for html-to-markdown conversion and creating zip files. It did possibly
create some duplicate utility functions instead of using existing ones, but I'm not sure, just
inferring by the fact that it had CORS issues w/ image downloads that it already had fixed once before.


Jan 27

had it implement image cropping support. It did not have problems doing this, however this was the first
time I noticed that the main infinite-canvas typescript file was too big for a single query (> 25000 tokens).

Asked for suggestions for refactoring this file. It made a list of 5 steps and a suggestion for an order of refactors.
I had it add to TODO file and then we did it step by step. After each step I did a bit of testing to make sure things
did not seem to have been super broken. Did not encounter any issues. InfiniteCanvas.tsx reduced from 2850 to 750 lines.

[[ this refactoring seemed to have burned through a lot of tokens...it was spawning lots of background agents
that presumably were all reading this large file. Seems like it might be a good idea to have something in
the claude.md system prompt stuff to try to get it to make separate functions rather than just dropping
functionality into the main canvas file... ]]



Jan 29

want to add 'offline' mode to the app so that I can have a functional demo version w/o the sever-side.
CC suggests various options for browser-local storage, we go back and forth and settle on a an IdexedDB wrapper.
It generates a plan. The plan seems kind of dumb, it's going to hardcode two paths when clearly at this point we
should have a generic storage API w/ two implementations. So I explain that and it updates the plan
(this is all via the TODO.md file). It wants to run all the ~5 major implementation tasks in parallel but this sounds
fishy to me so we do them one at a time. As far as I can tell in light testing, it's fully functional.


Next up - import and export of scenes. Here was my prompt:

> ok lets design a new feature. I want to be able to export and import entire scenes. For export, it should export        a zip of the scene. The zip should include the scene.json, history, and all images. For the images, if there is a
  crop rect I want it to export the original image and the cropped image. For import, it should give me the option
  to either import a zip or import by selecting a directory. The export and import options should be in a File
  menu. Please come up with a plan and put it in the TODO.md file.
  
refinement:
  
> instead of an import dialog, I would just like there to be "Import Scene from Zip..." and "Import Scene from Folder..." options in the File menu. These can launch the appropriate picker directly, we don't need the intermediate dialog. please update the plan.

told it to do everything. It did it. Did some manual testing, it worked. Made some minor UX changes w/ iterative edits and committed.




Jan 30

Did some UX cleanup, added hotkeys. App is very solid now! Does way more than I set out to do.

So, why not go crazy? Asked it to add support for videos. It came up with a plan, quite a lot of
steps but mainly this was just to add bits of support in all the difference places. I told it to
go and do it. It did, although it seems to have skipped a few steps in the plan. Worked out a few
UX kinks with incremental edits. Works great!

discovered saving had become quite slow. turns out it was downloading and re-uploading all images and videos 
every save. Dumb! easily fixed it though.

Added basic conflict-resolution, ie detecting if remote scene had changed on server. Show popup dialog
with options to stomp, fetch, or fork. Seems to work. 

Added Debug menu with ability to see scene and history json, to see what this thing is actually storing/etc.
Discovered it is storing full URLs to the images and videos, which shouldn't be necessary as they are
all relative to the server base URL. Asked it to change how this works, so it gets the base URL from
the server. It completely shit the bed trying to do this refactor! It went off and made duplicate versions
of some features that already were working. Also for some reason it decided to merge the feature branch
where it was working back into main, and push to github, without me saying so (up to this point I had always
been telling it when to merge and push, and usually when to commit, although sometimes it did commit on it's own).
Had it roll back these changes so we could try again with a more specific plan

Feb 1

Had some new ideas and decided that the current back-end structure was not ideal - each scene object was backed
by a separate file, even simple text blocks and prompt objects. I want it to be easy for an LLM to generate 
scene content, inlining this text in the scene will simplify that. So I asked for a detailed plan in TODO.
It's plan seems sensible, told it to do everything in a feature branch. Seems to be working fine.

Discovered some weirdness w/ images on the server. Asked CC to explain. It had apparently implemented some 
temporary upload storage to deal with images in unsaved scenes. More complicated than I expected, but sensible.
It suggested a way to clean up temporary files, seems to be working.

Noticed huge data URLs in history. Asked it about this. It explained it's due to deletes before images are uploaded.
CC suggested delete operations could wait until image upload finishes. Seems fine, agreed, it works.

Noticed empty scene folders being created on server when I make a new empty scene - scene file is not saved but an
empty history file was. Asked CC to fix. It did something...watched changes go by, they seem kinda dumb, but it works soo....

Created a list of minor improvements in TODO file. I'm pretty sure it would easily handle each of these.
Tell it to do them all at once. Actually does kind of a shit job, two out of 6 are wrong. 
The confusion seems to be that the things at not related, but there is overlap in words, eg
two are related to context menus, but different context menus. But it does the second
change to the first context menu.

Next up: video cropping support. Previously had asked about this and it had suggested using ffmpeg.wasm. 
Asked it to make a plan for implementation and get back to me. It points out that the wasm version is very
slow and (except in offline mode) we can use a server-side version which calls platform ffmpeg binary.
I agree with this plan except I would like to not have to install ffmpeg myself. It finds an npm module
that installs platform ffmpeg locally. I agree w/ the plan and tell it to continue.
It's going to town with agents...

It did OK. It forgot about installing ffmpeg-static so the video cropping did not actually work, but when
it fixed that, then it was functional, with a spinner animation. Various UX issues around menu appearance, fixed.
It hadn't updated Exporting to use the cropped video, fixed.

Discovered that with large videos, the video is lost if I reload the page because it actually hadn't finished uploading.
This is not apparent form the UI. Asked it to build a component that keeps track of background operations and shows 
the count in the status bar. I didn't ask it to make a plan...maybe it is going off the rails? 
Seems to have wrapped the entire App in this new component?!?

At some point dropping in a video has become somewhat broken - the video object isn't present in the reloaded scene.
CC adds some debug console output for me to look at. It seems like the upload is OK, the issue is the scene is not saving properly.
CC thinks the backend is removing the video from the scene for some reason. It's adding logging that I can't see.
It's saying the server is 404-ing trying to find the video, it's adding more logging. 
it keeps telling me it has figured out what was wrong, but it has not.
And now it's compacting....trouble.
It thinks it has figured it out and it does appear to work. Maybe should have compacted earlier.

ok realized I should have planned out video editing a bit more because I don't just want cropping.
I could either back it all out and start again, or power through. Decided to power through!
Asked it to add support for changing video speed. Told it to make a plan and do it.
It is doing OK. Then I ask for text boxes for cropping, and a constrain-aspect-ratio toggle.
We have to go back and forth on the UI quite a bit, to make it work nicely, but it does it.
Then I ask it to add support for removing audio. It grinds through it, seems to have done ok.

Discover that it is not actually saving the crop information in the server-side scene. 
Tell it to fix this.

Discovered video cropping is not working on initial upload, only after reloading scene.
Asked it to add some logging, and discovered it is sending URLs for a temp file that doesn't exist anymore.
Asked it to investigate the upload flow, it explains what it is doing, and suggests gross hacks to fix this issue.
The real issue is it is using full URLs when the server-side can construct the URL itself, which it doesn't seem to realize.
I tell it exactly what to do (this is engineering-level stuff, based on our system design).
This appears to fix the problem...and makes me think we need to revisit most of the API endpoints!

Find another bug that is due to this exact same problem. Again it wants to do messy hacks to track these changing URLs,
when the server can just tell us. I tell it to explicitly create an API endpoing that does this.
I think this is the first time I have basically had to tell it what code to write.
That makes it trivial to fix this problem.

went back to video editing system. Added a timeline for playback during cropping, and trim support,
and trim handles on the timeline. worked through various UX issues. Fixed problem with ffmpeg where
sometimes two passes are needed. This is really good now! 



Feb 2

Asked for AI query support in offline mode. Keys to be stored in localStorage, entered in settings dialog.
It build all this no problem. Added settings tab for managing localStorage & IndexedDB, no problem.

Asked it to add label support for images. It makes a detailed plan but forgets that the back-end exists,
and it forgets about undo/redo. I ask it to update the plan for this, and then implement.
Seems to do a fine job on the implementation though. Some minor tweaks for exporting and it is done.

Asked it to build a better crop UI based on the video cropping UI. It did it. Added a list of fixed
aspect ratios in a popup menu. No problem. Added special-case copy-paste for crop region. 

Noticed a flickering issue w/ editing the crop rect. It took a few tries but eventually realized this
was due to browser selection happening (for some reason). Disabled that and it's fixed.

Had it copy aspect ratio constraints and crop copy-paste over to video overlay. No problem.
Did some styling cleanup of video overlay. 








----------------------
rms80 website migration
----------------------

Asked CC to migrate my rms80.com website from squarespace to a new Astro site.

Continuously shit the bed.

Refuses to directly copy text, even when I beg it to copy it verbatim without any editing.
Sometimes works but any large block of text is edited.

Trying to copy large Research page with sections like Papers, Patents, Talks, Service.
It has changed many of the paper citation blocks (but titles and authors seem to still be correct). 
It insists on re-ordering things, drops parts of the lists, etc.

As a workaround I used 
https://euangoddard.github.io/clipboard2markdown/ to convert squarespace text+links to markdown,
and then ask CC to convert that markdown back to the new format. This works better
but it still wants to (eg) add in subsections, etc. 

it was able to do some cool stuff, like go through my list of patents and check if each patent
had been granted and update the description

